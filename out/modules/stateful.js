(function(){var t,e,r,i,n,o=function(t,e){function r(){this.constructor=t}for(var i in e)s.call(e,i)&&(t[i]=e[i]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},s={}.hasOwnProperty;t=require("./core.object"),r=require("stately.js"),i=require("when"),n=require("lodash"),e=function(t){function e(t,i){e.__super__.constructor.call(this),this.machine=r.machine(t,i),this.state=function(){return this.machine.getMachineState()},this.machine.bind(function(t,e,r){var i;return i={event:t,oldState:e,newState:r},this.emit(t,this,i),e!==r?this.emit(r,this,i):void 0}.bind(this))}return o(e,t),e.prototype.apply=function(){var t;return t=Array.prototype.slice.call(arguments,1),this.machine[arguments[0]].apply(this,t),this},e.prototype.promise=function(){var t,e;return e=i.defer(),t=Array.prototype.slice.call(arguments,1),this.apply.apply(this,[arguments[0],this,e].concat(t)),e.promise},e}(t),module.exports=e}).call(this);